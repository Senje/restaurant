!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.page=e()}(this,function(){"use strict";function t(t){return r(m(t))}var g=Array.isArray||function(t){return"[object Array]"==Object.prototype.toString.call(t)},i=_,e=m,n=r,o=y,d=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^()])+)\\))?|\\(((?:\\\\.|[^()])+)\\))([+*?])?|(\\*))"].join("|"),"g");function m(t){for(var e=[],n=0,i=0,o="";null!=(s=d.exec(t));){var r,a,s,h=s[0],c=s[1],p=s.index;o+=t.slice(i,p),i=p+h.length,c?o+=c[1]:(o&&(e.push(o),o=""),p=s[2],h=s[3],c=s[4],r=s[5],a=s[6],s=s[7],e.push({name:h||n++,prefix:p||"",delimiter:h=p||"/",optional:"?"===a||"*"===a,repeat:"+"===a||"*"===a,pattern:(c||r||(s?".*":"[^"+h+"]+?")).replace(/([=!:$\/()])/g,"\\$1")}))}return i<t.length&&(o+=t.substr(i)),o&&e.push(o),e}function r(h){for(var c=new Array(h.length),t=0;t<h.length;t++)"object"==typeof h[t]&&(c[t]=new RegExp("^"+h[t].pattern+"$"));return function(t){for(var e="",n=t||{},i=0;i<h.length;i++){var o=h[i];if("string"==typeof o)e+=o;else{var r,a=n[o.name];if(null==a){if(o.optional)continue;throw new TypeError('Expected "'+o.name+'" to be defined')}if(g(a)){if(!o.repeat)throw new TypeError('Expected "'+o.name+'" to not repeat, but received "'+a+'"');if(0===a.length){if(o.optional)continue;throw new TypeError('Expected "'+o.name+'" to not be empty')}for(var s=0;s<a.length;s++){if(r=encodeURIComponent(a[s]),!c[i].test(r))throw new TypeError('Expected all "'+o.name+'" to match "'+o.pattern+'", but received "'+r+'"');e+=(0===s?o.prefix:o.delimiter)+r}}else{if(r=encodeURIComponent(a),!c[i].test(r))throw new TypeError('Expected "'+o.name+'" to match "'+o.pattern+'", but received "'+r+'"');e+=o.prefix+r}}}return e}}function p(t){return t.replace(/([.+*?=^!:${}()[\]|\/])/g,"\\$1")}function w(t,e){return t.keys=e,t}function v(t){return t.sensitive?"":"i"}function y(t,e){for(var n=(e=e||{}).strict,i=!1!==e.end,o="",r=t[t.length-1],r="string"==typeof r&&/\/$/.test(r),a=0;a<t.length;a++){var s,h,c=t[a];"string"==typeof c?o+=p(c):(s=p(c.prefix),h=c.pattern,c.repeat&&(h+="(?:"+s+h+")*"),o+=h=c.optional?s?"(?:"+s+"("+h+"))?":"("+h+")?":s+"("+h+")")}return n||(o=(r?o.slice(0,-2):o)+"(?:\\/(?=$))?"),o+=i?"$":n&&r?"":"(?=\\/|$)",new RegExp("^"+o,v(e))}function _(t,e,n){if(g(e=e||[])?n=n||{}:(n=e,e=[]),t instanceof RegExp){var i=t,o=e,r=i.source.match(/\((?!\?)/g);if(r)for(var a=0;a<r.length;a++)o.push({name:a,prefix:null,delimiter:null,optional:!1,repeat:!1,pattern:null});return w(i,o)}if(g(t)){for(var s=t,h=e,c=n,p=[],d=0;d<s.length;d++)p.push(_(s[d],h,c).source);return w(new RegExp("(?:"+p.join("|")+")",v(c)),h)}for(var u=e,i=n,l=m(e=t),e=y(l,i),f=0;f<l.length;f++)"string"!=typeof l[f]&&u.push(l[f]);return w(e,u)}i.parse=e,i.compile=t,i.tokensToFunction=n,i.tokensToRegExp=o;var a,s="undefined"!=typeof document,h="undefined"!=typeof window,c="undefined"!=typeof history,u="undefined"!=typeof process,l=s&&document.ontouchstart?"touchstart":"click",f=h&&!(!window.history.location&&!window.location);function b(){this.callbacks=[],this.exits=[],this.current="",this.len=0,this._decodeURLComponents=!0,this._base="",this._strict=!1,this._running=!1,this._hashbang=!1,this.clickHandler=this.clickHandler.bind(this),this._onpopstate=this._onpopstate.bind(this)}function x(t,e){if("function"==typeof t)return x.call(this,"*",t);if("function"==typeof e)for(var n=new R(t,null,this),i=1;i<arguments.length;++i)this.callbacks.push(n.middleware(arguments[i]));else"string"==typeof t?this["string"==typeof e?"redirect":"show"](t,e):this.start(t)}function E(t,e,n){var n=this.page=n||x,i=n._window,o=n._hashbang,r=n._getBase(),a=(t="/"===t[0]&&0!==t.indexOf(r)?r+(o?"#!":"")+t:t).indexOf("?"),r=(this.canonicalPath=t,new RegExp("^"+r.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")));this.path=t.replace(r,"")||"/",o&&(this.path=this.path.replace("#!","")||"/"),this.title=s&&i.document.title,this.state=e||{},this.state.path=t,this.querystring=~a?n._decodeURLEncodedURIComponent(t.slice(a+1)):"",this.pathname=n._decodeURLEncodedURIComponent(~a?t.slice(0,a):t),this.params={},this.hash="",o||~this.path.indexOf("#")&&(r=this.path.split("#"),this.path=this.pathname=r[0],this.hash=n._decodeURLEncodedURIComponent(r[1])||"",this.querystring=this.querystring.split("#")[0])}function R(t,e,n){n=this.page=n||k,e=e||{};e.strict=e.strict||n._strict,this.path="*"===t?"(.*)":t,this.method="GET",this.regexp=i(this.path,this.keys=[],e)}b.prototype.configure=function(t){t=t||{},this._window=t.window||h&&window,this._decodeURLComponents=!1!==t.decodeURLComponents,this._popstate=!1!==t.popstate&&h,this._click=!1!==t.click&&s,this._hashbang=!!t.hashbang,t=this._window;this._popstate?t.addEventListener("popstate",this._onpopstate,!1):h&&t.removeEventListener("popstate",this._onpopstate,!1),this._click?t.document.addEventListener(l,this.clickHandler,!1):s&&t.document.removeEventListener(l,this.clickHandler,!1),this._hashbang&&h&&!c?t.addEventListener("hashchange",this._onpopstate,!1):h&&t.removeEventListener("hashchange",this._onpopstate,!1)},b.prototype.base=function(t){if(0===arguments.length)return this._base;this._base=t},b.prototype._getBase=function(){var t,e=this._base;return e||(t=h&&this._window&&this._window.location,h&&this._hashbang&&t&&"file:"===t.protocol&&(e=t.pathname)),e},b.prototype.strict=function(t){if(0===arguments.length)return this._strict;this._strict=t},b.prototype.start=function(t){var e,t=t||{};this.configure(t),!1!==t.dispatch&&(this._running=!0,f&&(e=this._window.location,e=this._hashbang&&~e.hash.indexOf("#!")?e.hash.substr(2)+e.search:this._hashbang?e.search+e.hash:e.pathname+e.search+e.hash),this.replace(e,null,!0,t.dispatch))},b.prototype.stop=function(){var t;this._running&&(this.current="",this.len=0,this._running=!1,t=this._window,this._click&&t.document.removeEventListener(l,this.clickHandler,!1),h&&t.removeEventListener("popstate",this._onpopstate,!1),h&&t.removeEventListener("hashchange",this._onpopstate,!1))},b.prototype.show=function(t,e,n,i){t=new E(t,e,this),e=this.prevContext;return this.prevContext=t,this.current=t.path,!1!==n&&this.dispatch(t,e),!1!==t.handled&&!1!==i&&t.pushState(),t},b.prototype.back=function(t,e){var n,i=this;0<this.len?(n=this._window,c&&n.history.back(),this.len--):t?setTimeout(function(){i.show(t,e)}):setTimeout(function(){i.show(i._getBase(),e)})},b.prototype.redirect=function(t,e){var n=this;"string"==typeof t&&"string"==typeof e&&x.call(this,t,function(t){setTimeout(function(){n.replace(e)},0)}),"string"==typeof t&&void 0===e&&setTimeout(function(){n.replace(t)},0)},b.prototype.replace=function(t,e,n,i){t=new E(t,e,this),e=this.prevContext;return this.prevContext=t,this.current=t.path,t.init=n,t.save(),!1!==i&&this.dispatch(t,e),t},b.prototype.dispatch=function(e,n){var i=0,o=0,r=this;function a(){var t=r.callbacks[i++];if(e.path===r.current)return t?void t(e,a):function(t){var e;t.handled||(e=this._window,(this._hashbang?f&&this._getBase()+e.location.hash.replace("#!",""):f&&e.location.pathname+e.location.search)!==t.canonicalPath&&(this.stop(),t.handled=!1,f&&(e.location.href=t.canonicalPath)))}.call(r,e);e.handled=!1}(n?function t(){var e=r.exits[o++];if(!e)return a();e(n,t)}:a)()},b.prototype.exit=function(t,e){if("function"==typeof t)return this.exit("*",t);for(var n=new R(t,null,this),i=1;i<arguments.length;++i)this.exits.push(n.middleware(arguments[i]))},b.prototype.clickHandler=function(t){if(1===this._which(t)&&!(t.metaKey||t.ctrlKey||t.shiftKey||t.defaultPrevented)){var e,n,i,o=t.target,r=t.path||(t.composedPath?t.composedPath():null);if(r)for(var a=0;a<r.length;a++)if(r[a].nodeName&&"A"===r[a].nodeName.toUpperCase()&&r[a].href){o=r[a];break}for(;o&&"A"!==o.nodeName.toUpperCase();)o=o.parentNode;o&&"A"===o.nodeName.toUpperCase()&&(n="object"==typeof o.href&&"SVGAnimatedString"===o.href.constructor.name,o.hasAttribute("download")||"external"===o.getAttribute("rel")||(e=o.getAttribute("href"),!this._hashbang&&this._samePath(o)&&(o.hash||"#"===e)||e&&-1<e.indexOf("mailto:")||(n?o.target.baseVal:o.target)||(n||this.sameOrigin(o.href))&&(e="/"!==(e=n?o.href.baseVal:o.pathname+o.search+(o.hash||""))[0]?"/"+e:e,n=e=u&&e.match(/^\/[a-zA-Z]:\//)?e.replace(/^\/[a-zA-Z]:\//,"/"):e,i=this._getBase(),0===e.indexOf(i)&&(e=e.substr(i.length)),this._hashbang&&(e=e.replace("#!","")),(!i||n!==e||f&&"file:"===this._window.location.protocol)&&(t.preventDefault(),this.show(n)))))}},b.prototype._onpopstate=(a=!1,h?(s&&"complete"===document.readyState?a=!0:window.addEventListener("load",function(){setTimeout(function(){a=!0},0)}),function(t){var e;a&&(t.state?(e=t.state.path,this.replace(e,t.state)):f&&(e=this._window.location,this.show(e.pathname+e.search+e.hash,void 0,void 0,!1)))}):function(){}),b.prototype._which=function(t){return null==(t=t||h&&this._window.event).which?t.button:t.which},b.prototype._toURL=function(t){var e=this._window;return"function"==typeof URL&&f?new URL(t,e.location.toString()):s?((e=e.document.createElement("a")).href=t,e):void 0},b.prototype.sameOrigin=function(t){var e;return!(!t||!f)&&(t=this._toURL(t),(e=this._window.location).protocol===t.protocol&&e.hostname===t.hostname&&(e.port===t.port||""===e.port&&(80==t.port||443==t.port)))},b.prototype._samePath=function(t){var e;return!!f&&(e=this._window.location,t.pathname===e.pathname&&t.search===e.search)},b.prototype._decodeURLEncodedURIComponent=function(t){return"string"==typeof t&&this._decodeURLComponents?decodeURIComponent(t.replace(/\+/g," ")):t},E.prototype.pushState=function(){var t=this.page,e=t._window,n=t._hashbang;t.len++,c&&e.history.pushState(this.state,this.title,n&&"/"!==this.path?"#!"+this.path:this.canonicalPath)},E.prototype.save=function(){var t=this.page;c&&t._window.history.replaceState(this.state,this.title,t._hashbang&&"/"!==this.path?"#!"+this.path:this.canonicalPath)},R.prototype.middleware=function(n){var i=this;return function(t,e){if(i.match(t.path,t.params))return t.routePath=i.path,n(t,e);e()}},R.prototype.match=function(t,e){var n=this.keys,i=t.indexOf("?"),i=~i?t.slice(0,i):t,o=this.regexp.exec(decodeURIComponent(i));if(!o)return!1;delete e[0];for(var r=1,a=o.length;r<a;++r){var s=n[r-1],h=this.page._decodeURLEncodedURIComponent(o[r]);void 0===h&&hasOwnProperty.call(e,s.name)||(e[s.name]=h)}return!0};var k=function t(){var e=new b;function n(){return x.apply(e,arguments)}return n.callbacks=e.callbacks,n.exits=e.exits,n.base=e.base.bind(e),n.strict=e.strict.bind(e),n.start=e.start.bind(e),n.stop=e.stop.bind(e),n.show=e.show.bind(e),n.back=e.back.bind(e),n.redirect=e.redirect.bind(e),n.replace=e.replace.bind(e),n.dispatch=e.dispatch.bind(e),n.exit=e.exit.bind(e),n.configure=e.configure.bind(e),n.sameOrigin=e.sameOrigin.bind(e),n.clickHandler=e.clickHandler.bind(e),n.create=t,Object.defineProperty(n,"len",{get:function(){return e.len},set:function(t){e.len=t}}),Object.defineProperty(n,"current",{get:function(){return e.current},set:function(t){e.current=t}}),n.Context=E,n.Route=R,n}(),e=k;return e.default=k,e});